# LP Creator 緊急修正計画書

**作成日:** 2025年06月13日  
**優先度:** 🔥 CRITICAL  
**状況:** ⚠️ Phase A完了、Phase A+ (緊急技術問題) 対応中

## 🚨 現状の深刻な問題点

### 1. UI/UX設計の根本的な誤り
- **問題:** チャットエリア内にLPプレビューが表示されている
- **期待動作:** 左側：チャット、右側：LPプレビューの2カラムレイアウト
- **影響:** ユーザー体験が完全に破綻

### 2. 生成されるLPの品質問題
- **CSS完全欠如:** スタイリングが一切適用されていない
- **画像表示不良:** alt textのみ表示、実際の画像が表示されない
- **レイアウト崩壊:** 1990年代のプレーンHTMLレベル
- **実用性:** 商用利用不可能

### 3. アーキテクチャの不整合 ✅ 解決済み
- ~~**計画書との乖離:** 実装が設計文書と全く異なる~~ ✅ 修正完了
- ~~**コンポーネント設計:** LpDisplayコンポーネントが存在しない~~ ✅ 修正完了
- ~~**状態管理:** メッセージフィルタリングロジックが複雑すぎる~~ ✅ 修正完了

### 4. 🚨 **新規発見問題: AI生成エラー**
- **スキーマ不整合:** `No object generated: response did not match schema` エラー
- **生成タイムアウト:** 55秒後に失敗する生成プロセス
- **信頼性:** LP生成が不安定で実用不可能

## 🎯 修正計画

### Phase A: 緊急対応（即時実行）

#### A1. UIレイアウトの根本修正
**Priority: 🔥 CRITICAL**
```
- page.tsx の MainView を完全に再設計
- 右側エリアを独立したLPプレビューエリアに変更
- チャットエリアからLPコンテンツを完全に分離
- 2カラムレイアウトの確実な実装
```

#### A2. 存在しないコンポーネントの作成
**Priority: 🔥 CRITICAL**
```
- app/components/LpDisplay.tsx を作成
- LPオブジェクトを受け取り、適切にレンダリング
- LPViewer.tsx との連携確保
```

#### A3. LP生成品質の最低限修正 ✅ 完了
**Priority: 🔥 CRITICAL**
```
- lpGeneratorTool.ts でCSS生成を強制
- 基本的なTailwind CSSクラスの適用
- 画像プレースホルダーの適切な実装
```

### Phase A+: 緊急技術問題対応（現在進行中）

#### A+1. AI生成エラーの根本解決 🔄 進行中
**Priority: 🔥 CRITICAL**
```
- Zodスキーマの厳密化と検証強化
- generateObjectのmode指定とmaxTokens調整
- フォールバック機能による失敗時の代替生成
- 詳細なエラーログと問題特定システム
```

#### A+2. 生成プロセスの安定化 🔄 進行中  
**Priority: 🔥 CRITICAL**
```
- バッチ処理による並列処理の最適化
- プログレス表示とStreamable UI改善
- 生成時間の短縮（55秒→20-30秒目標）
- エラー時の適切なユーザーフィードバック
```

### Phase B: 品質向上（短期実行）

#### B1. CSS/スタイリング強化
**Priority: 🔴 HIGH**
```
- lpGeneratorTool.ts のプロンプト改善
- レスポンシブデザインの実装
- 色彩・フォント・レイアウトの標準化
- Tailwind CSS利用の最適化
```

#### B2. 画像表示システム修正
**Priority: 🔴 HIGH**
```
- プレースホルダー画像の適切な実装
- 画像URLの生成と管理
- 編集モードでの画像差し替え機能
```

#### B3. 状態管理の簡素化
**Priority: 🟡 MEDIUM**
```
- メッセージフィルタリングロジックの簡素化
- UIState/AIStateの最適化
- 不要な複雑性の除去
```

### Phase C: 機能完成（中期実行）

#### C1. 編集機能の完全実装
**Priority: 🟡 MEDIUM**
```
- インライン編集の改善
- 部分更新機能の安定化
- undo/redo機能の実装
```

#### C2. エクスポート機能
**Priority: 🟢 LOW**
```
- HTML/CSS/JSの完全なエクスポート
- 自己完結型ファイルの生成
- ZIPダウンロード機能
```

## 📋 実装順序（優先度順）

### 🔥 今すぐ実行すべき作業

1. ✅ **LpDisplay.tsx の作成** - 存在しないコンポーネントの緊急作成
2. ✅ **page.tsx の MainView 修正** - 2カラムレイアウトの確実な実装
3. ✅ **lpGeneratorTool.ts のCSS生成修正** - 最低限見れるレベルへ

### 🔴 本日中に完了すべき作業

4. 🔄 **AI生成エラー修正** - スキーマ不整合問題の解決
5. 🔄 **生成安定化** - タイムアウト・失敗率の改善  
6. ⏳ **動作テスト** - 基本機能の確認

### 🟡 今週中に完了すべき作業

7. **レスポンシブデザイン対応**
8. **編集機能の安定化**
9. **エラーハンドリング強化**

## 🎯 成功基準

### 最低基準（Phase A完了）
- [x] 2カラムレイアウトが正常に動作
- [x] 生成されたLPが最低限見れるレベル
- [x] CSS/スタイリングが適用されている
- [x] 画像が適切に表示される

### 実用基準（Phase A+完了）
- [x] UI/UXレイアウトが正常動作
- [ ] 🔄 AI生成が安定して成功する
- [ ] 🔄 生成時間が実用的範囲（30秒以内）
- [ ] 🔄 エラー発生時の適切なフォールバック

### 商用基準（Phase B完了）
- [ ] 商用レベルのデザイン品質
- [ ] レスポンシブ対応
- [ ] 編集機能が安定動作
- [ ] 包括的なエラーハンドリング

### 完成基準（Phase C完了）
- [ ] 計画書と同等の機能
- [ ] エクスポート機能
- [ ] 包括的なテスト完了

## ⚠️ リスク要因

1. **技術的債務:** 現在のコードベースの複雑性
2. **時間制約:** 緊急性vs品質のトレードオフ
3. **依存関係:** Mastraフレームワークとの整合性
4. **ユーザビリティ:** 設計変更によるUX影響

## 🔄 次のアクション

**現在実行中 (Phase A+):**
1. ✅ スキーマ定義の強化とvalidation改善
2. ✅ generateObject設定の最適化
3. ✅ フォールバック機能の実装
4. 🔄 実際の生成テストとデバッグ

**Phase A+ 完了後の作業:**
- 生成成功率の検証（目標: 90%以上）
- 生成時間の測定（目標: 30秒以内）
- エラーハンドリングの包括的テスト
- Phase B（商用品質）への移行準備

**作業手順:**
- 各修正後に実際のLP生成テストを実行
- エラーログを詳細に分析し根本原因を特定
- 問題発見時は即座にスキーマ・プロンプトを調整